generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model dim_company {
  company_id   BigInt  @id @default(autoincrement())
  company_code String  @unique
  company_desc String?

  @@map("dim_company")
}

model dim_dept {
  dept_id   BigInt @id @default(autoincrement())
  dept_code String @unique

  @@map("dim_dept")
}

model dim_distribution_channel {
  dc_id   BigInt  @id @default(autoincrement())
  dc_code String  @unique
  dc_desc String?

  @@map("dim_distribution_channel")
}

model dim_uom {
  uom_id   BigInt @id @default(autoincrement())
  uom_code String @unique

  @@map("dim_uom")
}

model dim_material {
  material_id   BigInt  @id @default(autoincrement())
  material_code String  @unique
  material_desc String?

  @@map("dim_material")
}

model dim_sku {
  sku_id      BigInt @id @default(autoincrement())
  material_id BigInt
  pack_size   String
  uom_id      BigInt

  @@unique([material_id, pack_size, uom_id])
  @@map("dim_sku")
}

model dim_sales_org {
  sales_org_id         BigInt  @id @default(autoincrement())
  division             String?
  sales_organization   String?
  sales_office         String?
  sales_group          String?
  sales_representative String?

  @@unique([division, sales_organization, sales_office, sales_group, sales_representative])
  @@map("dim_sales_org")
}

model dim_month {
  month_id DateTime @id @db.Date
  yyyy_mm  String   @unique

  @@map("dim_month")
}

model forecast_run {
  run_id       BigInt   @id @default(autoincrement())
  anchor_month DateTime @db.Date
  created_at   DateTime @default(now())
  method       String?
  notes        String?

  @@map("forecast_run")
}

model fact_price {
  company_id BigInt
  sku_id     BigInt
  month_id   DateTime @db.Date
  price      Decimal  @db.Decimal(18, 4)

  @@id([company_id, sku_id, month_id])
  @@map("fact_price")
}

model fact_forecast {
  run_id              BigInt
  company_id          BigInt
  dept_id             BigInt
  sku_id              BigInt
  sales_org_id        BigInt
  dc_id               BigInt
  month_id            DateTime @db.Date
  forecast_qty        Decimal  @db.Decimal(18, 4)
  unit_price_snapshot Decimal? @db.Decimal(18, 4)
  revenue_snapshot    Decimal? @db.Decimal(18, 4)

  @@id([run_id, company_id, dept_id, sku_id, sales_org_id, dc_id, month_id])
  @@map("fact_forecast")
}

model saleforecast {
  id            BigInt   @id @default(autoincrement())
  anchor_month  DateTime @db.Date
  company_code  String?
  company_desc  String?
  material_code String?
  material_desc String?
  forecast_qty  Decimal  @db.Decimal(18, 4)
  metadata      Json?
  created_at    DateTime @default(now())
  updated_at    DateTime @default(now()) @updatedAt

  @@index([anchor_month], map: "idx_saleforecast_anchor_month")
  @@index([company_code], map: "idx_saleforecast_company_code")
  @@index([material_code], map: "idx_saleforecast_material_code")
  @@map("saleforecast")
}

model audit_logs {
  id            BigInt   @id @default(autoincrement())
  service       String
  endpoint      String
  action        String
  record_id     String?
  performed_by  String?
  metadata      Json?
  performed_at  DateTime @default(now())
  user_id       String?
  user_email    String?
  user_username String?
  client_id     String?

  @@index([action], map: "idx_audit_logs_action")
  @@index([performed_at], map: "idx_audit_logs_performed_at")
  @@map("audit_logs")
}

model staging_forecast_uploads {
  id          BigInt   @id @default(autoincrement())
  batch_id    String   @db.Uuid
  raw_json    Json
  imported_at DateTime @default(now())
  errors      Json?
}

model monthly_access_control {
  id           BigInt    @id @default(autoincrement())
  user_email   String
  user_id      String?
  user_name    String?
  anchor_month DateTime  @db.Date
  is_locked    Boolean   @default(false)
  locked_by    String?
  locked_at    DateTime?
  notes        String?
  created_at   DateTime  @default(now())
  updated_at   DateTime  @default(now()) @updatedAt

  @@unique([user_email, anchor_month])
  @@index([anchor_month], map: "idx_monthly_access_anchor_month")
  @@map("monthly_access_control")
}

model monthly_access_control_material {
  id            BigInt   @id @default(autoincrement())
  anchor_month  DateTime @db.Date
  material_code String
  material_desc String?
  created_at    DateTime @default(now())
  updated_at    DateTime @default(now()) @updatedAt

  @@unique([anchor_month, material_code])
  @@index([anchor_month], map: "idx_monthly_access_material_anchor_month")
  @@index([material_code], map: "idx_monthly_access_material_code")
  @@map("monthly_access_control_material")
}
